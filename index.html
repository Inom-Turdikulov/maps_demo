<!DOCTYPE>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Chef for seniors</title>

    <style type="text/css">
      body {
        margin: 0;
        padding: 10px 20px 20px;
        font-family: Arial;
        font-size: 16px;
      }

      #map-container {
        padding: 6px;
        border-width: 1px;
        border-style: solid;
        border-color: #ccc #ccc #999 #ccc;
        -webkit-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        -moz-box-shadow: rgba(64, 64, 64, 0.5) 0 2px 5px;
        box-shadow: rgba(64, 64, 64, 0.1) 0 2px 5px;
        width: 800px;
      }

      #map {
        width: 800px;
        height: 400px;
      }

      #actions {
        list-style: none;
        padding: 0;
      }

      #inline-actions {
        padding-top: 10px;
      }

      .item {
        margin-left: 20px;
      }

      .info-window-content img{
        display: none;
      }

      .info-window-content img + br,
      .info-window-content img + br + br{
        display: none;
      }
    </style>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmbz2P-aKZsB3uQT9wSYoRlIQ7UWCtKJQ"></script>
<script src="markers.json" type="text/javascript"></script>
    <script src="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js"></script>

    <script type="text/javascript">
      var styles = [[{
        height: 53,
        url: "images/m1.png",
        width: 53
      },
        {
          height: 56,
          url: "images/m2.png",
          width: 56
        },
        {
          height: 66,
          url: "images/m3.png",
          width: 66
        },
        {
          height: 78,
          url: "images/m4.png",
          width: 78
        },
        {
          height: 90,
          url: "images/m5.png",
          width: 90
        }
      ],[{
        url: 'images/people35.png',
        height: 35,
        width: 35,
        anchor: [16, 0],
        textColor: '#ff00ff',
        textSize: 10
      }, {
        url: 'images/people45.png',
        height: 45,
        width: 45,
        anchor: [24, 0],
        textColor: '#ff0000',
        textSize: 11
      }, {
        url: 'images/people55.png',
        height: 55,
        width: 55,
        anchor: [32, 0],
        textColor: '#ffffff',
        textSize: 12
      }], [{
        url: 'images/conv30.png',
        height: 27,
        width: 30,
        anchor: [3, 0],
        textColor: '#ff00ff',
        textSize: 10
      }, {
        url: 'images/conv40.png',
        height: 36,
        width: 40,
        anchor: [6, 0],
        textColor: '#ff0000',
        textSize: 11
      }, {
        url: 'images/conv50.png',
        width: 50,
        height: 45,
        anchor: [8, 0],
        textSize: 12
      }], [{
        url: 'images/heart30.png',
        height: 26,
        width: 30,
        anchor: [4, 0],
        textColor: '#ff00ff',
        textSize: 10
      }, {
        url: 'images/heart40.png',
        height: 35,
        width: 40,
        anchor: [8, 0],
        textColor: '#ff0000',
        textSize: 11
      }, {
        url: 'images/heart50.png',
        width: 50,
        height: 44,
        anchor: [12, 0],
        textSize: 12
      }]];

      var markerClusterer = null;
      var map = null;
      var imageUrl = 'images/marker.png';
      var infoWindow = new google.maps.InfoWindow();

      function refreshMap() {
        if (markerClusterer) {
          markerClusterer.clearMarkers();
        }

        var markers = [];

        var markerImage = {
            url: imageUrl,
            size: new google.maps.Size(28, 28),
            scaledSize: new google.maps.Size(28, 28)
        };

        var markersLength = markersData.features.length;
        for (var i = 0; i < markersLength; ++i) {
          var latLng = new google.maps.LatLng(
              markersData.features[i].geometry.coordinates[1],
              markersData.features[i].geometry.coordinates[0]
          )
          var marker = new google.maps.Marker({
           position: latLng,
           icon: markerImage,
           windowContent: markersData.features[i].properties.description,
           title: markersData.features[i].properties.name
          });

          markers.push(marker);
        }

        var zoom = parseInt(document.getElementById('zoom').value, 10);
        var size = parseInt(document.getElementById('size').value, 10);
        var style = parseInt(document.getElementById('style').value, 10);
        zoom = zoom == -1 ? null : zoom;
        size = size == -1 ? null : size;
        style = style == -1 ? null: style;

        markerClusterer = new MarkerClusterer(map, markers, {
          maxZoom: zoom,
          gridSize: size,
          styles: styles[style]
        });

        for(i = 0; i < markers.length; i++) {
            var marker = markers[i];

            google.maps.event.addListener(marker, 'click', (function(marker) {
                return function() {
                    infoWindow.setContent('<div class="info-window-content">'
                        + '<p><strong>'
                        + marker.title
                        + '</strong></p>'
                        + marker.windowContent

                        + '</div>');
                    infoWindow.open(map, this);
                }
            })(marker));
        }
      }

      function initialize() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 3.8,
          center: new google.maps.LatLng(33.046233, -96.994174),
          mapTypeId: google.maps.MapTypeId.ROADMAP,
          zoomControl: true,
          mapTypeControl: false,
          scaleControl: true,
          streetViewControl: true,
          rotateControl: true,
          fullscreenControl: true
        });

        var refresh = document.getElementById('refresh');
        google.maps.event.addDomListener(refresh, 'click', refreshMap);

        var clear = document.getElementById('clear');
        google.maps.event.addDomListener(clear, 'click', clearClusters);

        refreshMap();
      }

      function clearClusters(e) {
        e.preventDefault();
        e.stopPropagation();
        markerClusterer.clearMarkers();
      }
    </script>
  </head>
  <body onload="initialize();">
    <h3>Chef for seniors</h3>
    <div id="map-container">
      <div id="map"></div>
    </div>
    <div id="inline-actions">
      <span>Max zoom level:
        <select id="zoom">
          <option value="-1">Default</option>
          <option value="7">7</option>
          <option value="8">8</option>
          <option value="9">9</option>
          <option value="10">10</option>
          <option value="11">11</option>
          <option value="12">12</option>
          <option value="13">13</option>
          <option value="14">14</option>
        </select>

      </span>
      <span class="item">Cluster size:
        <select id="size">
          <option value="-1">Default</option>
          <option value="40">40</option>
          <option value="50">50</option>
          <option value="70">70</option>
          <option value="80">80</option>
        </select>
      </span>
      <span class="item">Cluster style:
        <select id="style">
          <option value="0">Default</option>
          <option value="1">People</option>
          <option value="2">Conversation</option>
          <option value="3">Heart</option>
       </select>
       <input id="refresh" type="button" value="UPDATE MAP!" class="item"/>
       <a href="#" id="clear">Clear</a>
    </div>
  </body>
</html>
